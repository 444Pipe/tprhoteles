{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ hotel.nombre }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        body { background: #f5f6f8; }
        .top-card { background: #fff; border: 0; border-radius: 14px; box-shadow: 0 8px 22px rgba(0,0,0,.06); }
        .gallery-main { height: 360px; object-fit: cover; width: 100%; border-radius: 10px; }
        .gallery-thumb { height: 174px; object-fit: cover; width: 100%; border-radius: 10px; }
        .room-carousel .carousel-item img { height: 170px; object-fit: cover; width: 100%; }
        .room-carousel .carousel-control-prev,
        .room-carousel .carousel-control-next { width: 14%; }
        .room-carousel .carousel-control-prev-icon,
        .room-carousel .carousel-control-next-icon { background-color: rgba(0,0,0,.45); border-radius: 999px; padding: 10px; }
        .chip { border-radius: 999px; padding: .3rem .75rem; background: #fff3ce; color: #5f4c00; font-size: .85rem; font-weight: 600; }
        .section-nav { position: sticky; top: 10px; z-index: 10; background: #fff; border-radius: 12px; box-shadow: 0 5px 16px rgba(0,0,0,.05); }
        .section-nav a { color: #1b2a4e; font-weight: 600; text-decoration: none; padding: .8rem 1rem; display: inline-block; }
        .section-nav a:hover { color: #0d6efd; }
        .section-nav a.active { color: #0d6efd; background: #eef5ff; border-radius: 8px; }
        .soft-card { border: 0; border-radius: 12px; box-shadow: 0 5px 16px rgba(0,0,0,.05); }
        .room-card { border: 0; border-radius: 14px; box-shadow: 0 6px 18px rgba(0,0,0,.06); overflow: hidden; transition: transform .2s ease, box-shadow .2s ease; }
        .room-card:hover { transform: translateY(-3px); box-shadow: 0 10px 22px rgba(0,0,0,.08); }
        .room-img { height: 170px; object-fit: cover; }
        .price { font-size: 1.25rem; font-weight: 700; color: #212529; }
        .filter-wrap { background: #fff; border-radius: 12px; box-shadow: 0 4px 14px rgba(0,0,0,.05); }
        .map-card { border: 0; border-radius: 14px; overflow: hidden; box-shadow: 0 8px 20px rgba(0,0,0,.06); }
        .service-list li { margin-bottom: .4rem; }
        .details-rich { color: #2f3a48; line-height: 1.62; }
        .details-rich h4 { color: #1b2a4e; font-weight: 700; margin-top: .25rem; }
        .details-rich h5 { color: #3f4e68; letter-spacing: .15px; text-transform: uppercase; }
        .details-rich ul { padding-left: 1.2rem; margin-bottom: .9rem; }
        .details-rich li { margin-bottom: .35rem; }
        .details-rich .info-block { background: #fafbfd; border: 1px solid #e8edf4; border-radius: 10px; padding: .9rem 1rem; margin-bottom: .85rem; }
        .details-rich .poi-list li::marker { color: #7a8ca8; }
        .details-rich .map-link { font-weight: 600; text-decoration: none; }
        .details-rich .map-link:hover { text-decoration: underline; }
        .details-expandable {
            max-height: 250px;
            overflow: hidden;
            position: relative;
            transition: max-height .35s ease;
        }
        .details-expandable::after {
            content: "";
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            height: 80px;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,1));
            pointer-events: none;
        }
        .details-expandable.expanded { max-height: 5000px; }
        .details-expandable.expanded::after { display: none; }
        .toggle-details-btn { font-weight: 600; }
        .poi-item-extra { display: none; }
        .poi-item-extra.show { display: list-item; }
        .copy-address-btn { font-size: .78rem; }
        .js-fade-in { opacity: 0; transform: translateY(10px); transition: opacity .45s ease, transform .45s ease; }
        .js-fade-in.is-visible { opacity: 1; transform: translateY(0); }
        .floating-reserve-btn {
            position: fixed;
            right: 20px;
            bottom: 20px;
            z-index: 1080;
            border-radius: 999px;
            padding: .8rem 1.1rem;
            font-weight: 700;
            box-shadow: 0 10px 24px rgba(0,0,0,.22);
        }
        @media (max-width: 767px) {
            .floating-reserve-btn {
                right: 12px;
                left: 12px;
                bottom: 12px;
                text-align: center;
            }
            body { padding-bottom: 84px; }
        }
    </style>
</head>
<body>
    <div class="container py-4 py-md-5">
        <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
            <a href="{% url 'hoteles_list' %}" class="btn btn-outline-dark"><i class="bi bi-arrow-left me-2"></i>Volver a hoteles</a>
            <a href="{% url 'reservar' hotel.id %}" class="btn btn-warning fw-bold">Reservar ahora</a>
        </div>

        <div class="top-card card p-3 p-md-4 mb-3">
            {% if hotel.imagen_static_url %}
            <img src="{{ hotel.imagen_static_url }}" alt="{{ hotel.nombre }}" class="gallery-main">
            {% elif hotel.imagen %}
            <img src="{{ hotel.imagen.url }}" alt="{{ hotel.nombre }}" class="gallery-main">
            {% else %}
            <img src="https://via.placeholder.com/1200x650?text=Hotel" alt="{{ hotel.nombre }}" class="gallery-main">
            {% endif %}
        </div>

        <div class="top-card card p-3 p-md-4 mb-3">
            <div class="d-flex flex-wrap gap-2 mb-2">
                <span class="chip">{{ hotel.tipo }}</span>
                <span class="chip">{{ hotel.municipio.nombre }}</span>
                {% if total_habitaciones %}<span class="chip">{{ total_habitaciones }} habitaciones</span>{% endif %}
            </div>
            <h1 class="h2 mb-1">{{ hotel.nombre }}</h1>
            <p class="mb-2"><i class="bi bi-geo-alt-fill me-2"></i>{{ hotel.direccion }}</p>
            <p class="text-muted mb-3">{{ hotel.descripcion }}</p>
            {% if precio_desde %}
            <div class="fw-semibold">Precio desde: $ {{ precio_desde }}</div>
            {% endif %}
        </div>

        <div class="section-nav p-1 mb-4">
            <a href="#resumen">Resumen</a>
            <a href="#habitaciones">Habitaciones</a>
            <a href="#ubicacion">Ubicación</a>
            <a href="#politicas">Políticas</a>
        </div>

        <section id="resumen" class="mb-4">
            <div class="soft-card card p-3 p-md-4">
                <h3 class="h5 mb-3">Servicios principales</h3>
                <div class="row g-3">
                    <div class="col-12 col-md-4">
                        <ul class="list-unstyled service-list mb-0">
                            <li><i class="bi bi-wifi me-2"></i>Wifi gratuito</li>
                            <li><i class="bi bi-snow me-2"></i>Aire acondicionado</li>
                            <li><i class="bi bi-cup-hot me-2"></i>{% if habitaciones and habitaciones.0.incluye_desayuno %}Desayuno incluido{% else %}Desayuno disponible{% endif %}</li>
                        </ul>
                    </div>
                    <div class="col-12 col-md-4">
                        <ul class="list-unstyled service-list mb-0">
                            <li><i class="bi bi-p-square me-2"></i>Estacionamiento {% if habitaciones and habitaciones.0.estacionamiento %}gratis{% else %}disponible{% endif %}</li>
                            <li><i class="bi bi-shield-check me-2"></i>Atención 24 horas</li>
                            <li><i class="bi bi-geo me-2"></i>Ubicación estratégica</li>
                        </ul>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="small text-muted">Acerca de esta propiedad</div>
                        <p class="mb-0">{{ hotel.descripcion }}</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="habitaciones" class="mb-4">
            <div class="filter-wrap p-3 p-md-4 mb-3">
                <div class="row g-3 align-items-end">
                    <div class="col-md-3">
                        <label class="form-label mb-1">Capacidad mínima</label>
                        <select id="capacityFilter" class="form-select">
                            <option value="">Todas</option>
                            <option value="1">1+ personas</option>
                            <option value="2">2+ personas</option>
                            <option value="3">3+ personas</option>
                            <option value="4">4+ personas</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label mb-1">Servicio</label>
                        <select id="serviceFilter" class="form-select">
                            <option value="">Todos</option>
                            <option value="desayuno">Con desayuno</option>
                            <option value="parking">Con estacionamiento</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label mb-1">Ordenar precio</label>
                        <select id="priceOrder" class="form-select">
                            <option value="">Recomendado</option>
                            <option value="asc">Menor a mayor</option>
                            <option value="desc">Mayor a menor</option>
                        </select>
                    </div>
                    <div class="col-md-3 d-grid">
                        <button id="clearFilters" class="btn btn-outline-secondary">Limpiar filtros</button>
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="h4 mb-0">Opciones de habitación</h3>
                <span class="text-muted small">Mostrando {{ total_habitaciones }} habitación(es)</span>
            </div>
            <div id="roomsContainer" class="row g-3">
                {% for habitacion in habitaciones %}
                <div class="col-12 col-md-6 col-lg-4 room-item"
                     data-capacidad="{{ habitacion.capacidad }}"
                     data-precio="{{ habitacion.precio }}"
                     data-desayuno="{% if habitacion.incluye_desayuno %}1{% else %}0{% endif %}"
                     data-parking="{% if habitacion.estacionamiento %}1{% else %}0{% endif %}">
                    <div class="room-card card h-100">
                        {% if habitacion.imagen_static_urls|length > 1 %}
                        <div id="roomCarousel{{ forloop.counter }}" class="carousel slide room-carousel" data-bs-ride="carousel">
                            <div class="carousel-indicators">
                                {% for img in habitacion.imagen_static_urls %}
                                <button type="button" data-bs-target="#roomCarousel{{ forloop.parentloop.counter }}" data-bs-slide-to="{{ forloop.counter0 }}" {% if forloop.first %}class="active" aria-current="true"{% endif %} aria-label="Imagen {{ forloop.counter }}"></button>
                                {% endfor %}
                            </div>
                            <div class="carousel-inner">
                                {% for img in habitacion.imagen_static_urls %}
                                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                                    <img src="{{ img }}" class="room-img card-img-top" alt="{{ habitacion.nombre }} - vista {{ forloop.counter }}">
                                </div>
                                {% endfor %}
                            </div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#roomCarousel{{ forloop.counter }}" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Anterior</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#roomCarousel{{ forloop.counter }}" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Siguiente</span>
                            </button>
                        </div>
                        {% elif habitacion.imagen_static_url %}
                        <img src="{{ habitacion.imagen_static_url }}" class="room-img card-img-top" alt="{{ habitacion.nombre }}">
                        {% else %}
                        <img src="https://via.placeholder.com/640x360?text=Habitaci%C3%B3n" class="room-img card-img-top" alt="{{ habitacion.nombre }}">
                        {% endif %}
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title mb-1">{{ habitacion.nombre }}</h5>
                            <p class="text-muted small mb-2">{{ habitacion.descripcion|default:"Habitación cómoda con excelente ubicación dentro del hotel." }}</p>
                            <ul class="list-unstyled small mb-3">
                                <li><i class="bi bi-people me-2"></i>{{ habitacion.capacidad }} persona(s)</li>
                                {% if habitacion.camas %}<li><i class="bi bi-moon-stars me-2"></i>{{ habitacion.camas }}</li>{% endif %}
                                {% if habitacion.metros_cuadrados %}<li><i class="bi bi-bounding-box me-2"></i>{{ habitacion.metros_cuadrados }} m²</li>{% endif %}
                                {% if habitacion.incluye_desayuno %}<li><i class="bi bi-cup-hot me-2"></i>Desayuno incluido</li>{% endif %}
                                {% if habitacion.estacionamiento %}<li><i class="bi bi-p-square me-2"></i>Estacionamiento</li>{% endif %}
                            </ul>
                            <div class="mt-auto d-flex align-items-center justify-content-between">
                                <span class="price">$ {{ habitacion.precio }}</span>
                                <a href="{% url 'reservar' hotel.id %}" class="btn btn-dark btn-sm">Ver precio</a>
                            </div>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-12">
                    <div class="alert alert-info mb-0">Este hotel aún no tiene habitaciones cargadas. Puedes agregarlas desde el panel admin.</div>
                </div>
                {% endfor %}
            </div>
        </section>

        <section id="ubicacion" class="mb-4">
            <h3 class="h4 mb-3">Ubicación del hotel</h3>
            <div class="map-card card">
                {% if hotel.mapa_embed_src %}
                <iframe
                    src="{{ hotel.mapa_embed_src }}"
                    width="100%"
                    height="360"
                    style="border:0;"
                    allowfullscreen=""
                    loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade">
                </iframe>
                {% else %}
                <div class="p-4">
                    <p class="mb-2"><i class="bi bi-geo-alt-fill me-2"></i>{{ hotel.direccion }}</p>
                    <p class="text-muted mb-0">Aún no hay mapa embebido configurado para este hotel.</p>
                </div>
                {% endif %}
            </div>

            {% if hotel.municipio.nombre == "Castilla La Nueva" %}
            <div class="soft-card card p-3 p-md-4 mt-3 details-rich js-fade-in">
                <h4 class="h6 mb-2">Información de la zona</h4>
                <p class="mb-2"><i class="bi bi-geo-alt-fill me-2"></i><span id="zoneAddress">calle 10#11a-09, Castilla La Nueva, Meta, 507041</span></p>
                <button id="copyZoneAddress" type="button" class="btn btn-outline-secondary btn-sm copy-address-btn mb-2">Copiar dirección</button>
                <p class="mb-3">
                    <a class="map-link" href="https://maps.google.com/?q=calle+10+11a-09,+Castilla+La+Nueva,+Meta" target="_blank" rel="noopener">Ver en el mapa</a>
                </p>

                <h5 class="h6 mb-2">Puntos de interés</h5>
                <ul class="mb-0 poi-list">
                    <li>Parque Nuevo Milenio - 3 min a pie - 0.3 km</li>
                    <li>Iglesia Principal - 5 min a pie - 0.5 km</li>
                    <li>Casa de la Cultura de Castilla La Nueva - 5 min a pie - 0.5 km</li>
                    <li class="poi-item-extra">Balneario Caño Cacayal - 10 min en auto - 3.2 km</li>
                    <li class="poi-item-extra">Parque acuático Cacayal - 16 min en auto - 5.4 km</li>
                </ul>
                <button id="togglePoiBtn" type="button" class="btn btn-link px-0 mt-2">Ver más puntos</button>
            </div>
            {% endif %}
        </section>

        <section id="politicas" class="mb-3">
            <div class="soft-card card p-3 p-md-4 js-fade-in">
                {% if hotel.municipio.nombre == "Castilla La Nueva" %}
                <div class="details-rich">
                <h3 class="h5 mb-3">Acerca de esta propiedad</h3>
                <div class="info-block">
                <h4 class="h6 mb-2">TPR Castilla Hotel Boutique</h4>
                <p class="mb-0">Disfruta de tu visita a Castilla la Nueva en TPR Castilla Hotel Boutique. Puedes disfrutar de un trago en el bar o comer algo rico en la cafetería.</p>
                </div>

                <div class="info-block">
                <h4 class="h6 mb-2">Datos generales</h4>
                <ul>
                    <li>Tamaño del hotel: 26 habitaciones</li>
                    <li>Horario de check-in: 12:00-cualquier hora del día</li>
                    <li>Edad mínima para hacer el check-in: 18</li>
                    <li>Check-out: 13:00</li>
                </ul>
                </div>

                <p class="small text-muted">*Consultar Cargos y políticas para ver más detalles y cargos adicionales.</p>

                <div id="castillaDetailsMore" class="details-expandable">

                <div class="info-block">
                <h4 class="h6 mb-2">Servicios en la propiedad</h4>
                <h5 class="small fw-semibold mb-1">Alimentos y bebidas</h5>
                <ul>
                    <li>Desayuno buffet incluido todos los días de 05:00 a 10:00</li>
                    <li>Restaurante</li>
                    <li>Bar</li>
                    <li>Cafetería</li>
                    <li>Café y té en las áreas comunes</li>
                    <li>Detalle de cortesía todos los días</li>
                </ul>

                <h5 class="small fw-semibold mb-1">Servicios</h5>
                <ul>
                    <li>Recepción abierta las 24 horas</li>
                    <li>Servicios de concierge</li>
                    <li>Servicio de tintorería/lavandería</li>
                </ul>
                </div>

                <div class="info-block">
                <h4 class="h6 mb-2">Servicios de la habitación</h4>
                <h5 class="small fw-semibold mb-1">Entretenimiento</h5>
                <ul>
                    <li>Televisión de pantalla plana de 30 pulgadas</li>
                    <li>Canales de televisión vía satélite</li>
                </ul>

                <h5 class="small fw-semibold mb-1">Para tu comodidad</h5>
                <ul>
                    <li>Aire acondicionado</li>
                    <li>Tabla de planchar/plancha (previa solicitud)</li>
                </ul>
                </div>

                <div class="info-block">
                <h4 class="h6 mb-2">Cargos y políticas</h4>
                <h5 class="small fw-semibold mb-1">Cargos obligatorios</h5>
                <p class="mb-2">En el momento del check-in o check-out en la propiedad, deberás pagar los siguientes cargos, que podrían incluir los impuestos aplicables:</p>
                <p>Es posible que debas pagar el IVA (impuesto al valor agregado) de Colombia (19%) en la propiedad. Las personas que presenten una visa de turismo y un pasaporte válidos donde se demuestre que no son residentes de Colombia y que paguen con una tarjeta de crédito extranjera o con una transferencia bancaria desde otro país estarán exentas del pago de este impuesto. La exención se aplica solo a las reservaciones de paquete (hospedaje y otro servicio de viaje).</p>

                <h5 class="small fw-semibold mb-1">Niños y camas adicionales</h5>
                <p>Si viajas con niños, es posible que debas presentar determinados documentos en la propiedad. Los padres que viajen a Colombia con hijos menores de 18 años posiblemente deban presentar el certificado de nacimiento del menor y su documento de identidad con foto (o pasaporte en el caso de personas extranjeras) al momento del check-in. Si el menor viaja acompañado por un familiar o tutor legal, este deberá presentar una autorización de viaje certificada y firmada por ambos padres, además de una copia del documento de los padres. Si el menor viaja con solo uno de sus padres, es posible que este deba presentar un consentimiento de viaje certificado y firmado por el otro padre. Se recomienda a las personas que vayan a viajar con menores que se pongan en contacto con el consulado de Colombia antes del viaje para recibir más información.</p>

                <h5 class="small fw-semibold mb-1">Política</h5>
                <ul>
                    <li>Esta propiedad no dispone de ascensor.</li>
                    <li>Esta propiedad acepta tarjetas de crédito, tarjetas de débito y efectivo.</li>
                    <li>Tarjetas de crédito aceptadas: Visa y Mastercard.</li>
                </ul>

                <h5 class="small fw-semibold mb-1">También se le conoce como</h5>
                <ul>
                    <li>Tpr Castilla Castilla La Nueva</li>
                    <li>TPR Castilla Hotel Boutique Hotel</li>
                    <li>TPR Castilla Hotel Boutique Castilla la Nueva</li>
                    <li>TPR Castilla Hotel Boutique Hotel Castilla la Nueva</li>
                </ul>
                </div>

                <div class="info-block mb-0">
                <h4 class="h6 mb-2">Preguntas frecuentes</h4>
                <p class="mb-1"><strong>¿Se aceptan mascotas en TPR Castilla Hotel Boutique?</strong></p>
                <p>No se permiten mascotas ni animales de servicio.</p>
                <p class="mb-1"><strong>¿Cuáles son los horarios de check-in y check-out en TPR Castilla Hotel Boutique?</strong></p>
                <p>Horario de check-in: 12:00-cualquier hora del día. Check-out: 13:00.</p>
                <p class="mb-1"><strong>¿Hay restaurantes en TPR Castilla Hotel Boutique o en los alrededores?</strong></p>
                <p class="mb-0">Sí, hay un restaurante en la propiedad.</p>
                </div>

                </div>
                <button id="toggleCastillaDetails" type="button" class="btn btn-outline-dark btn-sm mt-3 toggle-details-btn" data-target="castillaDetailsMore">Ver más información</button>
                </div>
                {% else %}
                <h3 class="h5 mb-3">Políticas y datos generales</h3>
                <div class="row g-3">
                    <div class="col-12 col-md-4">
                        <div class="fw-semibold">Check-in / Check-out</div>
                        <div class="small text-muted">Check-in desde 15:00</div>
                        <div class="small text-muted">Check-out hasta 12:00</div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="fw-semibold">Pagos aceptados</div>
                        <div class="small text-muted">Efectivo, Visa, MasterCard</div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="fw-semibold">Cancelación</div>
                        <div class="small text-muted">Sujeta a condiciones de tarifa y temporada.</div>
                    </div>
                </div>
                {% endif %}
            </div>
        </section>
    </div>

    <a href="{% url 'reservar' hotel.id %}" class="btn btn-warning floating-reserve-btn">
        <i class="bi bi-calendar-check me-2"></i>Reservar ahora
    </a>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const capacityFilter = document.getElementById('capacityFilter');
            const serviceFilter = document.getElementById('serviceFilter');
            const priceOrder = document.getElementById('priceOrder');
            const clearFilters = document.getElementById('clearFilters');
            const container = document.getElementById('roomsContainer');

            function applyFilters() {
                if (!container) return;
                const items = Array.from(container.querySelectorAll('.room-item'));
                const minCapacity = capacityFilter.value ? parseInt(capacityFilter.value, 10) : null;
                const service = serviceFilter.value;

                items.forEach(item => {
                    const capacity = parseInt(item.dataset.capacidad || '0', 10);
                    const desayuno = item.dataset.desayuno === '1';
                    const parking = item.dataset.parking === '1';

                    let visible = true;
                    if (minCapacity !== null && capacity < minCapacity) visible = false;
                    if (service === 'desayuno' && !desayuno) visible = false;
                    if (service === 'parking' && !parking) visible = false;

                    item.style.display = visible ? '' : 'none';
                });

                const order = priceOrder.value;
                if (order) {
                    const sorted = items.slice().sort((a, b) => {
                        const pa = parseFloat(a.dataset.precio || '0');
                        const pb = parseFloat(b.dataset.precio || '0');
                        return order === 'asc' ? pa - pb : pb - pa;
                    });
                    sorted.forEach(item => container.appendChild(item));
                }
            }

            if (container) {
                [capacityFilter, serviceFilter, priceOrder].forEach(control => {
                    if (control) control.addEventListener('change', applyFilters);
                });

                if (clearFilters) {
                    clearFilters.addEventListener('click', function () {
                        capacityFilter.value = '';
                        serviceFilter.value = '';
                        priceOrder.value = '';
                        applyFilters();
                    });
                }
            }

            const toggleCastillaDetails = document.getElementById('toggleCastillaDetails');
            if (toggleCastillaDetails) {
                toggleCastillaDetails.addEventListener('click', function () {
                    const targetId = this.dataset.target;
                    const target = document.getElementById(targetId);
                    if (!target) return;

                    target.classList.toggle('expanded');
                    const expanded = target.classList.contains('expanded');
                    this.textContent = expanded ? 'Ver menos información' : 'Ver más información';
                });
            }

            const sectionNavLinks = Array.from(document.querySelectorAll('.section-nav a'));
            const pageSections = sectionNavLinks
                .map(link => document.querySelector(link.getAttribute('href')))
                .filter(Boolean);

            sectionNavLinks.forEach(link => {
                link.addEventListener('click', function (event) {
                    const targetSelector = this.getAttribute('href');
                    const target = document.querySelector(targetSelector);
                    if (!target) return;
                    event.preventDefault();
                    const topOffset = 78;
                    const targetTop = target.getBoundingClientRect().top + window.scrollY - topOffset;
                    window.scrollTo({ top: targetTop, behavior: 'smooth' });
                });
            });

            function updateActiveSection() {
                const checkpoint = window.scrollY + 120;
                let currentId = '';
                pageSections.forEach(section => {
                    if (section.offsetTop <= checkpoint) {
                        currentId = section.id;
                    }
                });
                sectionNavLinks.forEach(link => {
                    const isActive = link.getAttribute('href') === `#${currentId}`;
                    link.classList.toggle('active', isActive);
                });
            }

            if (pageSections.length) {
                updateActiveSection();
                window.addEventListener('scroll', updateActiveSection, { passive: true });
            }

            const copyZoneAddress = document.getElementById('copyZoneAddress');
            const zoneAddress = document.getElementById('zoneAddress');
            if (copyZoneAddress && zoneAddress) {
                copyZoneAddress.addEventListener('click', async function () {
                    const text = zoneAddress.textContent.trim();
                    try {
                        await navigator.clipboard.writeText(text);
                        this.textContent = 'Dirección copiada';
                    } catch (error) {
                        this.textContent = 'No se pudo copiar';
                    }
                    setTimeout(() => {
                        this.textContent = 'Copiar dirección';
                    }, 1800);
                });
            }

            const togglePoiBtn = document.getElementById('togglePoiBtn');
            if (togglePoiBtn) {
                const extraPoiItems = Array.from(document.querySelectorAll('.poi-item-extra'));
                togglePoiBtn.addEventListener('click', function () {
                    const shouldShow = extraPoiItems.some(item => !item.classList.contains('show'));
                    extraPoiItems.forEach(item => item.classList.toggle('show', shouldShow));
                    this.textContent = shouldShow ? 'Ver menos puntos' : 'Ver más puntos';
                });
            }

            const revealTargets = document.querySelectorAll('.js-fade-in');
            if (revealTargets.length && 'IntersectionObserver' in window) {
                const revealObserver = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('is-visible');
                            observer.unobserve(entry.target);
                        }
                    });
                }, { threshold: 0.15 });
                revealTargets.forEach(element => revealObserver.observe(element));
            } else {
                revealTargets.forEach(element => element.classList.add('is-visible'));
            }
        });
    </script>
</body>
</html>
